<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Ross Cunning" />

<meta name="date" content="2016-07-28" />

<title>STJ2012 analysis</title>

<script src="STJ2012_analysis_files/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="STJ2012_analysis_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="STJ2012_analysis_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="STJ2012_analysis_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="STJ2012_analysis_files/bootstrap-3.3.5/shim/respond.min.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<link rel="stylesheet"
      href="STJ2012_analysis_files/highlight/default.css"
      type="text/css" />
<script src="STJ2012_analysis_files/highlight/highlight.js"></script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>




</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<div class="container-fluid main-container">

<!-- tabsets -->
<script src="STJ2012_analysis_files/navigation-1.0/tabsets.js"></script>
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="fluid-row" id="header">


<h1 class="title">STJ2012 analysis</h1>
<h4 class="author"><em>Ross Cunning</em></h4>
<h4 class="date"><em>July 28, 2016</em></h4>

</div>

<div id="TOC">
<ul>
<li><a href="#data-pre-processing">Data pre-processing</a><ul>
<li><a href="#import-dataset">Import dataset</a></li>
<li><a href="#filter-dataset">Filter dataset</a></li>
<li><a href="#transform-count-data">Transform count data</a></li>
</ul></li>
<li><a href="#data-analysis">Data analysis</a><ul>
<li><a href="#community-composition-barplots">Community composition barplots</a></li>
<li><a href="#differences-between-species-and-shores">Differences between species and shores</a></li>
<li><a href="#beta-diversity">Beta diversity</a></li>
<li><a href="#niche-breadth-of-symbiodinium">Niche breadth of <em>Symbiodinium</em></a></li>
</ul></li>
</ul>
</div>

<div id="data-pre-processing" class="section level1">
<h1>Data pre-processing</h1>
<div id="import-dataset" class="section level2">
<h2>Import dataset</h2>
<pre class="r"><code># Import OTU tables
OTU97 &lt;- otu_table(read.table(&quot;data/97_otu_table.tsv&quot;, header=T, check.names=F, row.names=1,
                              skip=1, sep=&quot;\t&quot;, comment.char=&quot;&quot;), taxa_are_rows=T)
OTU100 &lt;- otu_table(read.table(&quot;data/100_otu_table.tsv&quot;, header=T, check.names=F, row.names=1,
                               skip=1, sep=&quot;\t&quot;, comment.char=&quot;&quot;), taxa_are_rows=T)
# Import taxonomy
TAX97 &lt;- tax_table(as.matrix(read.table(&quot;data/97_tax_assignments.txt&quot;, sep=&quot;\t&quot;, row.names=2,
                                        col.names=c(&quot;Clade&quot;, &quot;OTU.ID&quot;, &quot;Taxonomy&quot;, &quot;Eval&quot;, &quot;Subtype&quot;))))
TAX100 &lt;- tax_table(as.matrix(read.table(&quot;data/100_tax_assignments.txt&quot;, sep=&quot;\t&quot;, row.names=2,
                                         col.names=c(&quot;Clade&quot;, &quot;OTU.ID&quot;, &quot;Taxonomy&quot;, &quot;Eval&quot;, &quot;Subtype&quot;))))
# Import sample data
SAM &lt;- sample_data(read.delim(&quot;data/mapping_file.txt&quot;, sep=&quot;\t&quot;, header=T, row.names=1))
# Build phyloseq objects
phy97 &lt;- phyloseq(OTU97, TAX97, SAM)
phy100 &lt;- phyloseq(OTU100, TAX100, SAM)</code></pre>
<div id="descriptive-statistics-and-distribution-of-otu-counts" class="section level4">
<h4>Descriptive statistics and distribution of OTU counts</h4>
<pre class="r"><code># Compute summary statistics
stats &lt;- function(phy) {
  return(
    data.frame(rangeotus=paste0(range(taxa_sums(phy)), collapse=&quot; - &quot;),
               nsingles=length(taxa_sums(phy)[taxa_sums(phy) &lt;= 1]),
               rangerps=paste0(range(sample_sums(phy)), collapse=&quot; - &quot;),
               amrps=paste(as.integer(mean(sample_sums(phy))), 
                           as.integer(sd(sample_sums(phy))), sep=&quot; ± &quot;),
               gmrps=paste(as.integer(exp(mean(log(sample_sums(phy))))),
                           as.integer(exp(sd(log(sample_sums(phy))))), sep=&quot; ± &quot;))
  )
}
stats97 &lt;- stats(phy97)
stats100 &lt;- stats(phy100)

# Create and plot histograms
phy &lt;- phy97
taxhist97 &lt;- hist(log10(taxa_sums(phy97)), plot=F)
samhist97 &lt;- hist(log10(sample_sums(phy97)), plot=F)

taxhist100 &lt;- hist(log10(taxa_sums(phy100)), plot=F)
samhist100 &lt;- hist(log10(sample_sums(phy100)), plot=F)

par(mfrow=c(2, 2), mar=c(3,3,1,1))
plot(taxhist97, col=&quot;black&quot;, main=&quot;97% OTU counts&quot;, xlim=c(0, 5), las=1, mgp=c(2,0.5,0),
     xlab=&quot;No. sequences (log10)&quot;, ylab=&quot;No. OTUs&quot;, cex.lab=0.75, cex.axis=0.75)
plot(taxhist100, col=&quot;black&quot;, main=&quot;100% OTU counts&quot;, xlim=c(0, 5), las=1, mgp=c(2,0.5,0),
     xlab=&quot;No. sequences (log10)&quot;, ylab=&quot;No. OTUs&quot;, cex.lab=0.75, cex.axis=0.75)
plot(samhist97, col=&quot;black&quot;, main=&quot;97% OTU reads per sample&quot;, xlim=c(0, 5), las=1, mgp=c(2,0.5,0),
     xlab=&quot;No. sequences (log10)&quot;, ylab=&quot;No. samples&quot;, cex.lab=0.75, cex.axis=0.75)
plot(samhist100, col=&quot;black&quot;, main=&quot;100% OTU reads per sample&quot;, xlim=c(0, 5), las=1, mgp=c(2,0.5,0),
     xlab=&quot;No. sequences (log10)&quot;, ylab=&quot;No. samples&quot;, cex.lab=0.75, cex.axis=0.75)</code></pre>
<p><img src="STJ2012_analysis_files/figure-html/phy_stats-1.png" width="768" /></p>
<table style="width:121%;">
<colgroup>
<col width="45%" />
<col width="36%" />
<col width="38%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">97% OTUs</th>
<th align="left">100% OTUs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Total count in OTU table</td>
<td align="left">1099772</td>
<td align="left">738482</td>
</tr>
<tr class="even">
<td align="left">Number of OTUs</td>
<td align="left">132</td>
<td align="left">29813</td>
</tr>
<tr class="odd">
<td align="left">Range of OTU counts</td>
<td align="left">2 - 386018</td>
<td align="left">2 - 137998</td>
</tr>
<tr class="even">
<td align="left">Number of singleton OTUs</td>
<td align="left">0</td>
<td align="left">0</td>
</tr>
<tr class="odd">
<td align="left">Number of samples</td>
<td align="left">83</td>
<td align="left">83</td>
</tr>
<tr class="even">
<td align="left">Range of reads per sample</td>
<td align="left">3 - 56742</td>
<td align="left">1 - 35719</td>
</tr>
<tr class="odd">
<td align="left">Mean (±SD) reads per sample (arithmetic)</td>
<td align="left">13250 ± 11973</td>
<td align="left">8897 ± 8378</td>
</tr>
<tr class="even">
<td align="left">Mean (±SD) reads per sample (geometric)</td>
<td align="left">4692 ± 10</td>
<td align="left">2985 ± 10</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="filter-dataset" class="section level2">
<h2>Filter dataset</h2>
<div id="filter-samples-by-minimum-count" class="section level4">
<h4>Filter samples by minimum count</h4>
<pre class="r"><code># Set threshold number of reads
sn &lt;- 10
# Remove samples with fewer reads than threshold
phy97.f &lt;- prune_samples(sample_sums(phy97)&gt;=sn, phy97)
phy100.f &lt;- prune_samples(sample_sums(phy100)&gt;=sn, phy100)</code></pre>
<ul>
<li>Number of samples remaining in 97% OTU dataset: 81</li>
<li>Number of samples remaining in 100% OTU dataset: 78</li>
</ul>
</div>
<div id="filter-otus-by-minimum-count" class="section level4">
<h4>Filter OTUs by minimum count</h4>
<pre class="r"><code># Set threshold count
n &lt;- 1
# Identify OTUs below threshold count
taxa97 &lt;- taxa_sums(phy97.f)[which(taxa_sums(phy97.f) &gt;= n)]  
taxa100 &lt;- taxa_sums(phy100.f)[which(taxa_sums(phy100.f) &gt;= n)]
# Remove taxa below threshold count
phy97.f &lt;- prune_taxa(names(taxa97), phy97.f)  
phy100.f &lt;- prune_taxa(names(taxa100), phy100.f)  </code></pre>
<ul>
<li>Number of OTUs remaining in 97% dataset: 130</li>
<li>Number of OTUs remaining in 97% dataset: 29813</li>
</ul>
</div>
<div id="filtered-data-descriptive-statistics-and-distribution-of-otus" class="section level4">
<h4>Filtered data: descriptive statistics and distribution of OTUs</h4>
<pre class="r"><code># Compute summary statistics
stats97.f &lt;- stats(phy97.f)
stats100.f &lt;- stats(phy100.f)

# Create and plot histograms
taxhist97 &lt;- hist(log10(taxa_sums(phy97.f)), plot=F)
taxhist100 &lt;- hist(log10(taxa_sums(phy100.f)), plot=F)
samhist97 &lt;- hist(log10(sample_sums(phy97.f)), plot=F)
samhist100 &lt;- hist(log10(sample_sums(phy100.f)), plot=F)

par(mfrow=c(2, 2), mar=c(3,3,1,1))
plot(taxhist97, col=&quot;black&quot;, main=&quot;97% OTU counts&quot;, xlim=c(0, 5), las=1, mgp=c(2,0.5,0),
     xlab=&quot;No. sequences (log10)&quot;, ylab=&quot;No. OTUs&quot;, cex.lab=0.75, cex.axis=0.75)
plot(taxhist100, col=&quot;black&quot;, main=&quot;100% OTU counts&quot;, xlim=c(0, 5), las=1, mgp=c(2,0.5,0),
     xlab=&quot;No. sequences (log10)&quot;, ylab=&quot;No. OTUs&quot;, cex.lab=0.75, cex.axis=0.75)
plot(samhist97, col=&quot;black&quot;, main=&quot;97% OTU reads per sample&quot;, xlim=c(0, 5), las=1, mgp=c(2,0.5,0),
     xlab=&quot;No. sequences (log10)&quot;, ylab=&quot;No. samples&quot;, cex.lab=0.75, cex.axis=0.75)
plot(samhist100, col=&quot;black&quot;, main=&quot;100% OTU reads per sample&quot;, xlim=c(0, 5), las=1, mgp=c(2,0.5,0),
     xlab=&quot;No. sequences (log10)&quot;, ylab=&quot;No. samples&quot;, cex.lab=0.75, cex.axis=0.75)</code></pre>
<p><img src="STJ2012_analysis_files/figure-html/phy.f_histograms-1.png" width="768" /></p>
<table style="width:129%;">
<colgroup>
<col width="45%" />
<col width="44%" />
<col width="38%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">97% OTUs</th>
<th align="left">100% OTUs</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Total count in OTU table</td>
<td align="left">1099765</td>
<td align="left">738459</td>
</tr>
<tr class="even">
<td align="left">Number of OTUs</td>
<td align="left">130</td>
<td align="left">29813</td>
</tr>
<tr class="odd">
<td align="left">Range of OTU counts</td>
<td align="left">2 - 386018</td>
<td align="left">1 - 137995</td>
</tr>
<tr class="even">
<td align="left">Number of singleton OTUs</td>
<td align="left">0</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">Number of samples</td>
<td align="left">81</td>
<td align="left">78</td>
</tr>
<tr class="even">
<td align="left">Range of reads per sample</td>
<td align="left">10 - 56742</td>
<td align="left">19 - 35719</td>
</tr>
<tr class="odd">
<td align="left">Mean (±SD) reads per sample (arithmetic)</td>
<td align="left">13577 ± 11935</td>
<td align="left">9467 ± 8324</td>
</tr>
<tr class="even">
<td align="left">Mean (±SD) reads per sample (geometric)</td>
<td align="left">5607 ± 7</td>
<td align="left">4581 ± 5</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="transform-count-data" class="section level2">
<h2>Transform count data</h2>
<pre class="r"><code># Convert to proportion (relative abundance)
phy97.f.p &lt;- transform_sample_counts(phy97.f, function(x) x/sum(x))
phy100.f.p &lt;- transform_sample_counts(phy100.f, function(x) x/sum(x))
# Apply transformation function
transform &lt;- function(x) sqrt(x/sum(x))  # Set transformation function
phy97.f.t &lt;- transform_sample_counts(phy97.f, transform)  # Transform data
phy100.f.t &lt;- transform_sample_counts(phy100.f, transform)</code></pre>
<hr />
</div>
</div>
<div id="data-analysis" class="section level1">
<h1>Data analysis</h1>
<div id="community-composition-barplots" class="section level2">
<h2>Community composition barplots</h2>
<p>Here the composition of each sample is plotted as a horizontal bar, sorted by species and shore. Each segment of the bar represents an individual OTU. In the lefthand plot, all OTUs are colored by clade, in the right OTU, all OTUs are given a unique color.</p>
<pre class="r"><code># Define function to plot Symbiodinium community composition
composition &lt;- function(phy, col, legend=T) {
  samdat &lt;- data.frame(sample_data(phy))
  samdat$Genus &lt;- factor(samdat$Genus, levels=rev(levels(samdat$Genus)))
  samdat$Species &lt;- factor(samdat$Species, levels=rev(levels(samdat$Species)))
  samdat$Shore &lt;- factor(samdat$Shore, levels=rev(levels(samdat$Shore)))
  samdat &lt;- samdat[with(samdat, order(Genus, Species, Shore)), ]
  typerelabund &lt;- as.matrix(otu_table(phy)[order(data.frame(tax_table(phy))$Subtype), 
                                           rownames(samdat)])
  shorebreaks &lt;- c(as.character(samdat$Shore), &quot;X&quot;)==c(&quot;X&quot;, as.character(samdat$Shore))
  shorebreaks &lt;- which(shorebreaks==F) - 1
  spbreaks &lt;- c(which(duplicated(samdat$Species)==F) - 1, nrow(samdat))
  # Make Barplot
  barplot(typerelabund, horiz=T, space=0, axes=F,axisnames=F, yaxs=&quot;i&quot;, col=col)
  rect(0, 0, par(&quot;usr&quot;)[2], par(&quot;usr&quot;)[4], lwd=1, xpd=T)
  axis(side=1, at=seq(0, 1, 0.1), line=0, tck=-0.025, mgp=c(0,0.25,0), cex.axis=0.7)
  mtext(side=1, &quot;Relative abundance&quot;, cex=0.7, line=1)
  # Add legend
  if (legend==T) {
    legend(x=par(&quot;usr&quot;)[2]/2, y=par(&quot;usr&quot;)[4], xjust=0.5, yjust=0.25, horiz=T, bty=&quot;n&quot;, xpd=T, 
           cex=0.7, legend=c(&quot;A&quot;, &quot;B&quot;, &quot;C&quot;, &quot;D&quot;, &quot;F&quot;), fill=taxcolors, x.intersp=0.5)
    legend(x=par(&quot;usr&quot;)[2]-0.03, y=par(&quot;usr&quot;)[4], xjust=0, yjust=0.1, bty=&quot;n&quot;, xpd=T, cex=0.6, 
           pt.cex=0.6, legend=c(&quot;N Shore&quot;, &quot;S Shore&quot;), fill=c(0, &quot;gray40&quot;), y.intersp=0.7, 
           x.intersp=0.3)
  }
  # Add grouping bars for Shore
  for (i in 1:length(shorebreaks)) {
    lines(c(0, 1), c(shorebreaks[i], shorebreaks[i]), lty=2, lwd=0.25)
    rect(1.01, shorebreaks[i], 1.04, shorebreaks[i+1], col=rep(c(&quot;gray40&quot;, 0), 50)[i], 
         lwd=0.25, xpd=T)
  }
  # Add lines to separate species and species names
  for (i in 1:length(spbreaks)) {
    lines(c(0, 1.07), c(spbreaks[i], spbreaks[i]), xpd=T, type=&quot;l&quot;, lwd=0.4)
    text(1.03, (spbreaks[i] + spbreaks[i+1]) / 2, xpd=T, pos=4, cex=0.6,
        labels=paste(samdat$Genus[which(duplicated(samdat$Species)==F)][i], &quot;\n&quot;,
                    samdat$Species[which(duplicated(samdat$Species)==F)][i], sep=&quot;&quot;))
  }
}

par(mfrow=c(1,2), mar=c(2, 1.5, 2, 5), lwd=0.1, cex=0.7)
composition(phy97.f.p, col=taxcolors[data.frame(tax_table(phy97.f.p))[order(data.frame(tax_table(phy97.f.p))$Subtype), ]$Clade], legend=T)
composition(phy97.f.p, col=rainbow(ntaxa(phy97.f.p)), legend=F)</code></pre>
<p><img src="STJ2012_analysis_files/figure-html/cladecomp-1.png" width="768" /></p>
<pre class="r"><code>par(mfrow=c(1,2), mar=c(2, 1.5, 2, 5), lwd=0.1, cex=0.7)
composition(phy100.f.p, col=taxcolors[data.frame(tax_table(phy100.f.p))[order(data.frame(tax_table(phy100.f.p))$Subtype), ]$Clade], legend=T)
composition(phy100.f.p, col=rainbow(ntaxa(phy100.f.p)), legend=F)</code></pre>
<p><img src="STJ2012_analysis_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>phy.f.p &lt;- phy97.f.p
phy.f.t &lt;- phy97.f.t</code></pre>
</div>
<div id="differences-between-species-and-shores" class="section level2">
<h2>Differences between species and shores</h2>
<p>Whether <em>Symbiodinium</em> communities differ among species, or differ between north vs. south shores within species, is evaluated here using permutational analysis of variance (PERMANOVA).</p>
<pre class="r"><code># PERMANOVA for differences among species? Post-hoc: which spp are different?

permanova.spp.t &lt;- adonis(phyloseq::distance(phy.f.t, &quot;bray&quot;) ~ Species, 
                          data=as(sample_data(phy.f.t), &quot;data.frame&quot;), permutations=9999)

dmat &lt;- as(phyloseq::distance(phy.f.t, &quot;bray&quot;), &quot;matrix&quot;)
df &lt;- as(sample_data(phy.f.t), &quot;data.frame&quot;)


pairs &lt;- data.frame(t(combn(levels(df$Species), 2)), stringsAsFactors=F)
p.pairs &lt;- setNames(rep(NA, nrow(pairs)), with(pairs, paste(X1, X2, sep=&#39;-&#39;)))

for (i in 1:nrow(pairs)) {
  dfs &lt;- subset(df, Species %in% c(pairs[i,1], pairs[i,2]))
  dmats &lt;- dmat[rownames(dfs), rownames(dfs)]
  set.seed(152470)
  permanova &lt;- adonis(dmats ~ Species, data=dfs, permutations=999)
  p.pairs[i] &lt;- permanova$aov.tab$`Pr(&gt;F)`[1]
}

multcompLetters(p.pairs)</code></pre>
<pre><code>## alcicornis  annularis astreoides  cavernosa  cylindrus     fragum 
##       &quot;ab&quot;       &quot;ab&quot;        &quot;c&quot;        &quot;d&quot;        &quot;a&quot;        &quot;a&quot; 
##    furcata    radians    siderea   strigosa 
##        &quot;e&quot;        &quot;f&quot;        &quot;d&quot;        &quot;b&quot;</code></pre>
<pre class="r"><code># Compute within- and between-pool statistics for each Species
shorestats &lt;- data.frame(matrix(dimnames=list(levels(data.frame(sample_data(phy.f.t))$Species), 
                                              c(&quot;Species&quot;, &quot;n&quot;, &quot;overall&quot;, &quot;within&quot;, 
                                                &quot;between&quot;, &quot;R2&quot;, &quot;bd&quot;, &quot;p&quot;)), ncol=8, nrow=10))
for (i in 1:nlevels(data.frame(sample_data(phy.f.t))$Species)) {
  sp &lt;- levels(data.frame(sample_data(phy.f.t))$Species)[i]
  shorestats$Species[i] &lt;- sp
  phy.f.t.species &lt;- subset_samples(phy.f.t, Species==sp)  # Set temp phyloseq object
  shorestats$n[i] &lt;- nsamples(phy.f.t.species)
  md &lt;- meandist(phyloseq::distance(phy.f.t.species, &quot;bray&quot;), 
                 sample_data(phy.f.t.species)$Shore)
  shorestats$within[i] &lt;- summary(md)$W  # Weighted mean dissimilarity within both Pools
  shorestats$between[i] &lt;- summary(md)$B  # Mean dissimilarity between Pools
  shorestats$overall[i] &lt;- summary(md)$D  # Overall dissimilarity
  if (nlevels(as(sample_data(phy.f.t.species), &quot;data.frame&quot;)$Shore) &gt; 1) {
    set.seed(70235)
    permanova &lt;- adonis(phyloseq::distance(phy.f.t.species, &quot;bray&quot;) ~ Shore, 
                        data=as(sample_data(phy.f.t.species), &quot;data.frame&quot;), permutations=999)
    shorestats$R2[i] &lt;- permanova$aov.tab$&quot;R2&quot;[1]  # PERMANOVA partial R-squared
    shorestats$p[i] &lt;- permanova$aov.tab$&quot;Pr(&gt;F)&quot;[1]  # PERMANOVA p-value
    bd &lt;- betadisper(phyloseq::distance(phy.f.t.species, &quot;bray&quot;),
                     group=as(sample_data(phy.f.t.species), &quot;data.frame&quot;)$Shore)
    shorestats$bd[i] &lt;- TukeyHSD(bd)$group[4]
  } else {
    shorestats$R2[i] &lt;- NA
    shorestats$p[i] &lt;- NA
    shorestats$bd[i] &lt;- NA
  }
}
knitr::kable(shorestats)  # dendrogyra, porites furcata, and siderastrea siderea differ by shore</code></pre>
<table>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">Species</th>
<th align="right">n</th>
<th align="right">overall</th>
<th align="right">within</th>
<th align="right">between</th>
<th align="right">R2</th>
<th align="right">bd</th>
<th align="right">p</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alcicornis</td>
<td align="left">alcicornis</td>
<td align="right">10</td>
<td align="right">0.63</td>
<td align="right">0.67</td>
<td align="right">0.59</td>
<td align="right">0.04</td>
<td align="right">1.00</td>
<td align="right">0.72</td>
</tr>
<tr class="even">
<td align="left">annularis</td>
<td align="left">annularis</td>
<td align="right">5</td>
<td align="right">0.60</td>
<td align="right">0.60</td>
<td align="right">NaN</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">astreoides</td>
<td align="left">astreoides</td>
<td align="right">5</td>
<td align="right">0.10</td>
<td align="right">0.10</td>
<td align="right">NaN</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">cavernosa</td>
<td align="left">cavernosa</td>
<td align="right">7</td>
<td align="right">0.33</td>
<td align="right">0.38</td>
<td align="right">0.29</td>
<td align="right">0.12</td>
<td align="right">0.44</td>
<td align="right">0.87</td>
</tr>
<tr class="odd">
<td align="left">cylindrus</td>
<td align="left">cylindrus</td>
<td align="right">8</td>
<td align="right">0.07</td>
<td align="right">0.06</td>
<td align="right">0.07</td>
<td align="right">0.23</td>
<td align="right">0.66</td>
<td align="right">0.09</td>
</tr>
<tr class="even">
<td align="left">fragum</td>
<td align="left">fragum</td>
<td align="right">8</td>
<td align="right">0.29</td>
<td align="right">0.34</td>
<td align="right">0.24</td>
<td align="right">0.09</td>
<td align="right">0.50</td>
<td align="right">0.82</td>
</tr>
<tr class="odd">
<td align="left">furcata</td>
<td align="left">furcata</td>
<td align="right">9</td>
<td align="right">0.83</td>
<td align="right">0.67</td>
<td align="right">0.97</td>
<td align="right">0.38</td>
<td align="right">0.61</td>
<td align="right">0.03</td>
</tr>
<tr class="even">
<td align="left">radians</td>
<td align="left">radians</td>
<td align="right">10</td>
<td align="right">0.14</td>
<td align="right">0.15</td>
<td align="right">0.14</td>
<td align="right">0.10</td>
<td align="right">0.57</td>
<td align="right">0.75</td>
</tr>
<tr class="odd">
<td align="left">siderea</td>
<td align="left">siderea</td>
<td align="right">10</td>
<td align="right">0.55</td>
<td align="right">0.57</td>
<td align="right">0.54</td>
<td align="right">0.08</td>
<td align="right">0.48</td>
<td align="right">0.53</td>
</tr>
<tr class="even">
<td align="left">strigosa</td>
<td align="left">strigosa</td>
<td align="right">9</td>
<td align="right">0.89</td>
<td align="right">0.87</td>
<td align="right">0.90</td>
<td align="right">0.15</td>
<td align="right">0.78</td>
<td align="right">0.27</td>
</tr>
</tbody>
</table>
</div>
<div id="beta-diversity" class="section level2">
<h2>Beta diversity</h2>
<p>Beta diversity is evaluated here as the multivariate dispersion of samples within a coral species group. Principal coordinate analysis on Bray-Curtis dissimilarities is used to calculate average distance-to-centroid values for each species group, which are then compared statistically by a permutation test. This analysis is implemented using betadisper() in the vegan package, based on <a href="dx.doi.org/10.1111/j.1541-0420.2005.00440.x">Anderson (2006)</a>.</p>
<pre class="r"><code># Calculate distances to species centroids for each sample in principal coordinate space
sambd &lt;- betadisper(d=vegdist(t(otu_table(phy.f.t)), method=&quot;bray&quot;), 
                    group=data.frame(sample_data(phy.f.t))$Species, type=&quot;centroid&quot;,
                    bias.adjust=TRUE)
# Calculate each species&#39; mean distance to centroid and standard error
sambdsumm &lt;- aggregate(data.frame(mean=sambd$distances), by=list(group=sambd$group), FUN=mean)
sambdsumm$se &lt;- aggregate(sambd$distances, by=list(group=sambd$group), 
                      FUN=function(x) sd(x)/sqrt(length(x)))$x
# Determine order of decreasing mean dispersion
sambdsumm.ord &lt;- sambdsumm[order(sambdsumm$mean, decreasing=T), ]
# Update betadisper object with species in decreasing order of mean dispersion
sambd &lt;- betadisper(d=vegdist(t(otu_table(phy.f.t)), method=&quot;bray&quot;), 
                    group=factor(data.frame(sample_data(phy.f.t))$Species, levels=as.character(sambdsumm.ord$group)), type=&quot;centroid&quot;, bias.adjust=TRUE)
# Use permutations to perform pairwise comparisons of group mean dispersions
sampt &lt;- permutest(sambd, pairwise=T)
saml &lt;- multcompLetters(sampt$pairwise$permuted)

# Figure: Distance to centroids
par(mfrow=c(1,1), mar=c(3.5,4,1,1), lwd=1)
with(sambdsumm.ord, {
  plot(mean, type=&quot;n&quot;, ylim=c(0, 0.75), ylab=&quot;Distance to centroid&quot;, xaxt=&quot;n&quot;, xlab=&quot;&quot;)
  arrows(1:10, mean - se, 1:10, mean + se, length=0.05, angle=90, code=3)
  points(1:10, mean, cex=1, pch=21, bg=&quot;white&quot;)
  text(1:10, par(&quot;usr&quot;)[3]-0.025, srt=45, adj=1, xpd=T, cex=0.75, 
       labels=levels(SAM$Species)[order(sambdsumm$mean, decreasing=T)])
  text(1:10, mean + se + 0.03, labels=saml$Letters[as.character(group)], cex=0.5)
})</code></pre>
<p><img src="STJ2012_analysis_files/figure-html/betadisper-1.png" width="384" /></p>
<pre class="r"><code>dstr97 &lt;- subset_samples(phy97.f.p, Species==&quot;strigosa&quot;)
plot_bar(dstr97, x=&quot;Sample&quot;, y=&quot;Abundance&quot;, fill=&quot;OTU&quot;)</code></pre>
<p><img src="STJ2012_analysis_files/figure-html/strigosa-1.png" width="672" /></p>
<pre class="r"><code>plot_bar(dstr97, x=&quot;Sample&quot;, y=&quot;Abundance&quot;, fill=&quot;Subtype&quot;)</code></pre>
<p><img src="STJ2012_analysis_files/figure-html/strigosa-2.png" width="672" /></p>
<pre class="r"><code># D strigosa hosted B1, B24, B35, B38, and C3 in Finney et al.... B25, B35, and B38 are missing from ref database.
# Also try 100% OTUs -- must filter more first...
#dstr100.f &lt;- subset_samples(phy100.f, Species==&quot;strigosa&quot;)
#dstr100.f.p &lt;- transform_sample_counts(dstr100.f, function(x) x/sum(x))
#dstr100.f.p.f &lt;- prune_taxa(rownames(otu_table(dstr100.f.p))[which(rowSums(otu_table(dstr100.f.p)) &gt; 0.01)],
#                            dstr100.f.p)
#  
#plot_bar(dstr100.f.p.f, x=&quot;Sample&quot;, y=&quot;Abundance&quot;, fill=&quot;OTU&quot;)
#plot_bar(dstr100, x=&quot;Sample&quot;, y=&quot;Abundance&quot;, fill=&quot;Subtype&quot;)
#sample_names(dstr100.f)
#subset_samples(dstr100, Sample==&quot;7&quot;)
#otu_table(dstr100.f)
#dstr100.f.p &lt;- transform_sample_counts(dstr100.f, function(x) x/sum(x))
#colSums(otu_table(dstr100.f.p)[rowSums(otu_table(dstr100.f.p)) &gt; 0.1, ])</code></pre>
</div>
<div id="niche-breadth-of-symbiodinium" class="section level2">
<h2>Niche breadth of <em>Symbiodinium</em></h2>
<pre class="r"><code># Mean dispersion of clades
otubd &lt;- betadisper(d=vegdist(otu_table(phy.f.t), method=&quot;bray&quot;), 
                    group=data.frame(tax_table(phy.f.t))$Clade, type=&quot;centroid&quot;)
otubd</code></pre>
<pre><code>## 
##  Homogeneity of multivariate dispersions
## 
## Call: betadisper(d = vegdist(otu_table(phy.f.t), method = &quot;bray&quot;),
## group = data.frame(tax_table(phy.f.t))$Clade, type = &quot;centroid&quot;)
## 
## No. of Positive Eigenvalues: 125
## No. of Negative Eigenvalues: 3
## 
## Average distance to centroid:
##     A     B     C     D     F     G 
## 0.659 0.696 0.695 0.632 0.675 0.533 
## 
## Eigenvalues for PCoA axes:
## PCoA1 PCoA2 PCoA3 PCoA4 PCoA5 PCoA6 PCoA7 PCoA8 
##   2.4   2.0   1.7   1.5   1.5   1.4   1.4   1.4</code></pre>
<pre class="r"><code># Number of samples each OTU appears in
nsamp &lt;- data.frame(n=rowSums(otu_table(phy.f.t) != 0))
nsamp$Subtype &lt;- data.frame(tax_table(phy.f.t))[rownames(nsamp), &quot;Subtype&quot;]
nsamp[order(nsamp$n, decreasing=T), ]</code></pre>
<pre><code>##            n          Subtype
## denovo143 38      B1_AF333511
## denovo92  21    C131_JF320826
## denovo175 17      A4_AF333509
## denovo51  13 C1cstar_AY239364
## denovo173  6      D1_AF334660
## denovo185  6    F5.2_AM748594
## denovo158  5      B1_AF333511
## denovo19   4      C7_AF499797
## denovo98   4      B1_AF333511
## denovo58   4   D1a.1_JF683338
## denovo162  4    C45a_AY765404
## denovo174  2 C1cstar_AY239364
## denovo11   2 C1cstar_AY239364
## denovo142  2     B19_DQ865212
## denovo77   2     D1a_AF499802
## denovo83   2    F5.2_AM748594
## denovo134  2     B19_DQ865212
## denovo135  2     B19_DQ865212
## denovo26   1    C45a_AY765404
## denovo25   1    B112_AF360566
## denovo22   1    G100_AB253788
## denovo20   1      A4_AF333509
## denovo28   1    G3.2_KC597694
## denovo176  1     C31_AY258496
## denovo177  1     B10_AF499787
## denovo172  1   C1002_DQ838544
## denovo170  1    F5.2_AM748594
## denovo171  1    F5.2_AM748594
## denovo178  1      B1_AF333511
## denovo179  1     B19_DQ865212
## denovo18   1      B1_AF333511
## denovo12   1   C31.1_HQ630876
## denovo10   1    G100_AB253788
## denovo16   1    F5.2_AM748594
## denovo17   1    G3.2_KC597694
## denovo14   1    G100_AB253788
## denovo15   1   C17.2_FJ461513
## denovo149  1     B19_DQ865212
## denovo148  1      B1_AF333511
## denovo141  1      A4_AF333509
## denovo140  1    F5.2_AM748594
## denovo147  1      A4_AF333509
## denovo129  1     D1a_AF499802
## denovo128  1    G3.1_KC597688
## denovo154  1 C1cstar_AY239364
## denovo156  1      A4_AF333509
## denovo150  1      B1_AF333511
## denovo153  1     B19_DQ865212
## denovo93   1    F5.2_AM748594
## denovo90   1    C1.6_FJ461493
## denovo91   1      A4_AF333509
## denovo94   1    B112_AF360566
## denovo95   1      A4_AF333509
## denovo78   1      B7_AF499784
## denovo79   1      B1_AF333511
## denovo71   1    B112_AF360566
## denovo72   1     B16_AY258469
## denovo73   1      B1_AF333511
## denovo74   1   C1144_DQ182637
## denovo75   1    F5.2_AM748594
## denovo76   1   C31.1_HQ630876
## denovo85   1     B19_DQ865212
## denovo84   1    C131_JF320826
## denovo86   1      B1_AF333511
## denovo81   1 C1cstar_AY239364
## denovo80   1     C66_AY589771
## denovo82   1    C45a_AY765404
## denovo121  1     C15_AY239369
## denovo120  1      A4_AF333509
## denovo122  1   C21.2_JF683324
## denovo88   1 C1cstar_AY239364
## denovo69   1      B1_AF333511
## denovo63   1      B1_AF333511
## denovo62   1 C1cstar_AY239364
## denovo61   1      B1_AF333511
## denovo67   1      B1_AF333511
## denovo66   1    F5.2_AM748594
## denovo138  1      A4_AF333509
## denovo139  1      B1_AF333511
## denovo132  1      B2_AF333512
## denovo133  1    C45a_AY765404
## denovo130  1      B1_AF333511
## denovo131  1    C131_JF320826
## denovo56   1      B1_AF333511
## denovo55   1 C1cstar_AY239364
## denovo52   1    F5.2_AM748594
## denovo53   1      B1_AF333511
## denovo50   1     B16_AY258469
## denovo183  1    B101_AY074986
## denovo182  1      B1_AF333511
## denovo180  1      B1_AF333511
## denovo189  1      B5_AF499781
## denovo188  1      B5_AF499781
## denovo109  1    F5.2_AM748594
## denovo108  1     B10_AF499787
## denovo106  1     B19_DQ865212
## denovo104  1    B115_AF360572
## denovo103  1   C3.22_HE579010
## denovo102  1    C131_JF320826
## denovo40   1      B1_AF333511
## denovo44   1 C1cstar_AY239364
## denovo46   1     B19_DQ865212
## denovo49   1      A4_AF333509
## denovo48   1    F5.2_AM748594
## denovo0    1 C1cstar_AY239364
## denovo1    1      B1_AF333511
## denovo3    1      B1_AF333511
## denovo4    1    C131_JF320826
## denovo5    1 C1cstar_AY239364
## denovo7    1    B122_EU074871
## denovo8    1      B1_AF333511
## denovo9    1     B19_DQ865212
## denovo110  1  C15.26_KC597686
## denovo111  1    B125_EU074865
## denovo112  1    B119_EU099825
## denovo117  1      A4_AF333509
## denovo118  1    B125_EU074865
## denovo119  1     C22_AY239373
## denovo34   1     C31_AY258496
## denovo36   1      D2_AY686649
## denovo37   1 C1cstar_AY239364
## denovo31   1     B16_AY258469
## denovo39   1   C1002_DQ838544
## denovo124  1      B1_AF333511
## denovo164  1 C1cstar_AY239364
## denovo167  1      B1_AF333511
## denovo166  1      C1_AF333515
## denovo161  1 C1cstar_AY239364
## denovo163  1   C17.2_FJ461513
## denovo169  1    F5.2_AM748594</code></pre>
<pre class="r"><code>nsamp</code></pre>
<pre><code>##            n          Subtype
## denovo26   1    C45a_AY765404
## denovo25   1    B112_AF360566
## denovo22   1    G100_AB253788
## denovo20   1      A4_AF333509
## denovo28   1    G3.2_KC597694
## denovo176  1     C31_AY258496
## denovo177  1     B10_AF499787
## denovo174  2 C1cstar_AY239364
## denovo175 17      A4_AF333509
## denovo172  1   C1002_DQ838544
## denovo173  6      D1_AF334660
## denovo170  1    F5.2_AM748594
## denovo171  1    F5.2_AM748594
## denovo178  1      B1_AF333511
## denovo179  1     B19_DQ865212
## denovo18   1      B1_AF333511
## denovo19   4      C7_AF499797
## denovo12   1   C31.1_HQ630876
## denovo10   1    G100_AB253788
## denovo11   2 C1cstar_AY239364
## denovo16   1    F5.2_AM748594
## denovo17   1    G3.2_KC597694
## denovo14   1    G100_AB253788
## denovo15   1   C17.2_FJ461513
## denovo149  1     B19_DQ865212
## denovo148  1      B1_AF333511
## denovo143 38      B1_AF333511
## denovo142  2     B19_DQ865212
## denovo141  1      A4_AF333509
## denovo140  1    F5.2_AM748594
## denovo147  1      A4_AF333509
## denovo129  1     D1a_AF499802
## denovo128  1    G3.1_KC597688
## denovo158  5      B1_AF333511
## denovo154  1 C1cstar_AY239364
## denovo156  1      A4_AF333509
## denovo150  1      B1_AF333511
## denovo153  1     B19_DQ865212
## denovo92  21    C131_JF320826
## denovo93   1    F5.2_AM748594
## denovo90   1    C1.6_FJ461493
## denovo91   1      A4_AF333509
## denovo94   1    B112_AF360566
## denovo95   1      A4_AF333509
## denovo98   4      B1_AF333511
## denovo78   1      B7_AF499784
## denovo79   1      B1_AF333511
## denovo71   1    B112_AF360566
## denovo72   1     B16_AY258469
## denovo73   1      B1_AF333511
## denovo74   1   C1144_DQ182637
## denovo75   1    F5.2_AM748594
## denovo76   1   C31.1_HQ630876
## denovo77   2     D1a_AF499802
## denovo85   1     B19_DQ865212
## denovo84   1    C131_JF320826
## denovo86   1      B1_AF333511
## denovo81   1 C1cstar_AY239364
## denovo80   1     C66_AY589771
## denovo83   2    F5.2_AM748594
## denovo82   1    C45a_AY765404
## denovo121  1     C15_AY239369
## denovo120  1      A4_AF333509
## denovo122  1   C21.2_JF683324
## denovo88   1 C1cstar_AY239364
## denovo69   1      B1_AF333511
## denovo63   1      B1_AF333511
## denovo62   1 C1cstar_AY239364
## denovo61   1      B1_AF333511
## denovo67   1      B1_AF333511
## denovo66   1    F5.2_AM748594
## denovo138  1      A4_AF333509
## denovo139  1      B1_AF333511
## denovo132  1      B2_AF333512
## denovo133  1    C45a_AY765404
## denovo130  1      B1_AF333511
## denovo131  1    C131_JF320826
## denovo134  2     B19_DQ865212
## denovo135  2     B19_DQ865212
## denovo58   4   D1a.1_JF683338
## denovo56   1      B1_AF333511
## denovo55   1 C1cstar_AY239364
## denovo52   1    F5.2_AM748594
## denovo53   1      B1_AF333511
## denovo50   1     B16_AY258469
## denovo51  13 C1cstar_AY239364
## denovo185  6    F5.2_AM748594
## denovo183  1    B101_AY074986
## denovo182  1      B1_AF333511
## denovo180  1      B1_AF333511
## denovo189  1      B5_AF499781
## denovo188  1      B5_AF499781
## denovo109  1    F5.2_AM748594
## denovo108  1     B10_AF499787
## denovo106  1     B19_DQ865212
## denovo104  1    B115_AF360572
## denovo103  1   C3.22_HE579010
## denovo102  1    C131_JF320826
## denovo40   1      B1_AF333511
## denovo44   1 C1cstar_AY239364
## denovo46   1     B19_DQ865212
## denovo49   1      A4_AF333509
## denovo48   1    F5.2_AM748594
## denovo0    1 C1cstar_AY239364
## denovo1    1      B1_AF333511
## denovo3    1      B1_AF333511
## denovo4    1    C131_JF320826
## denovo5    1 C1cstar_AY239364
## denovo7    1    B122_EU074871
## denovo8    1      B1_AF333511
## denovo9    1     B19_DQ865212
## denovo110  1  C15.26_KC597686
## denovo111  1    B125_EU074865
## denovo112  1    B119_EU099825
## denovo117  1      A4_AF333509
## denovo118  1    B125_EU074865
## denovo119  1     C22_AY239373
## denovo34   1     C31_AY258496
## denovo36   1      D2_AY686649
## denovo37   1 C1cstar_AY239364
## denovo31   1     B16_AY258469
## denovo39   1   C1002_DQ838544
## denovo124  1      B1_AF333511
## denovo164  1 C1cstar_AY239364
## denovo167  1      B1_AF333511
## denovo166  1      C1_AF333515
## denovo161  1 C1cstar_AY239364
## denovo163  1   C17.2_FJ461513
## denovo162  4    C45a_AY765404
## denovo169  1    F5.2_AM748594</code></pre>
<pre class="r"><code>?order</code></pre>
<pre><code>## Help on topic &#39;order&#39; was found in the following packages:
## 
##   Package               Library
##   data.table            /Library/Frameworks/R.framework/Versions/3.2/Resources/library
##   BiocGenerics          /Library/Frameworks/R.framework/Versions/3.2/Resources/library
##   base                  /Library/Frameworks/R.framework/Resources/library
## 
## 
## Using the first match ...</code></pre>
<p>plot_richness(phy.f, x=“Species”)</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
